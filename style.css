/* =========================================
   1. VARIABLES & THEME
   ========================================= */
:root {
    /* Colors - Deep Indigo Theme */
    --color-primary-50: #eef2ff;
    --color-primary-100: #e0e7ff;
    --color-primary-500: #6366f1;
    --color-primary-600: #4f46e5;
    --color-primary-700: #4338ca;

    --color-slate-50: #f8fafc;
    --color-slate-100: #f1f5f9;
    --color-slate-200: #e2e8f0;
    --color-slate-300: #cbd5e1;
    --color-slate-400: #94a3b8;
    --color-slate-500: #64748b;
    --color-slate-600: #475569;
    --color-slate-700: #334155;
    --color-slate-800: #1e293b;
    --color-slate-900: #0f172a;

    --color-white: #ffffff;
    --color-danger: #ef4444;
    --color-success: #22c55e;

    /* Semantic Colors - Light (Default) */
    --bg-app: var(--color-slate-50);
    --bg-card: var(--color-white);
    --bg-header: rgba(255, 255, 255, 0.85);
    --bg-input-group: var(--color-slate-100);
    --bg-checkbox: var(--color-slate-100);
    --bg-checkbox-hover: var(--color-slate-200);
    --border-color: var(--color-slate-200);
    --border-color-hover: var(--color-slate-300);

    --text-main: var(--color-slate-800);
    --text-muted: var(--color-slate-500);
    --text-light: var(--color-slate-50);

    --shadow-color: rgb(0 0 0 / 0.1);

    /* Typography */
    /* Font Stack: prioritized for legibility + CJK support */
    --font-sans: "gg sans", "Noto Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
    --font-mono: "gg sans mono", "gg mono", "Source Code Pro", Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, "Noto Sans", "Noto Sans TC", "Microsoft JhengHei", "Meiryo", monospace;

    /* Spacing & Radius */
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --radius-full: 9999px;

    --shadow-sm: 0 1px 2px 0 var(--shadow-color);
    --shadow-md: 0 4px 6px -1px var(--shadow-color), 0 2px 4px -2px var(--shadow-color);
    --shadow-lg: 0 10px 15px -3px var(--shadow-color), 0 4px 6px -4px var(--shadow-color);

    --header-height: 64px;
}

/* Dark Theme */
[data-theme="dark"] {
    --bg-app: #0f172a;
    /* Slate 950ish */
    --bg-card: #1e293b;
    /* Slate 800 */
    --bg-header: rgba(30, 41, 59, 0.85);
    --bg-input-group: #334155;
    /* Slate 700 */
    --bg-checkbox: #334155;
    --bg-checkbox-hover: #475569;
    --border-color: #334155;
    --border-color-hover: #475569;

    --text-main: #f1f5f9;
    /* Slate 100 */
    --text-muted: #94a3b8;
    /* Slate 400 */
    --text-light: #f8fafc;

    --color-slate-50: #1e293b;
    /* Re-mapped for some backgrounds */
    --color-slate-100: #334155;
    --color-slate-200: #475569;
    --color-slate-500: #94a3b8;
    --color-slate-700: #e2e8f0;
    --color-slate-800: #f8fafc;

    --shadow-color: rgb(0 0 0 / 0.3);
}

/* =========================================
   2. RESET & BASE
   ========================================= */
*,
*::before,
*::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    -webkit-tap-highlight-color: transparent;
}

body {
    font-family: var(--font-sans);
    background-color: var(--bg-app);
    /* Subtle premium gradient */
    background-image:
        radial-gradient(circle at 10% 20%, rgba(99, 102, 241, 0.03) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(99, 102, 241, 0.03) 0%, transparent 20%);
    color: var(--text-main);
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    height: 100vh;
    /* Fixed height for app-like feel */
    overflow: hidden;
    /* Prevent body scroll, handle inside containers */
}

[data-theme="dark"] body {
    /* Slightly different gradient for dark mode */
    background-image:
        radial-gradient(circle at 50% 0%, rgba(99, 102, 241, 0.08) 0%, transparent 50%);
}

/* =========================================
   3. LAYOUT
   ========================================= */
.app-container {
    display: flex;
    flex-direction: column;
    height: 100%;
    max-width: 1400px;
    /* Limit max width on ultrawide */
    margin: 0 auto;
    position: relative;
    /* Context for z-index */
}

/* Header */
.app-header {
    height: var(--header-height);
    background-color: var(--bg-header);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border-color);
    position: sticky;
    top: 0;
    z-index: 50;
    flex-shrink: 0;
    transition: background-color 0.3s, border-color 0.3s;
}

.header-content {
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    /* Changed to space-between for toggle button */
    padding: 0 1.5rem;
}

.header-title-group {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    color: var(--color-primary-600);
}

[data-theme="dark"] .header-title-group {
    color: var(--color-primary-500);
    /* Lighter indigo for readibility on dark */
}

.header-icon {
    width: 28px;
    height: 28px;
    filter: drop-shadow(0 2px 4px rgba(99, 102, 241, 0.2));
    /* Glow effect */
}

h1 {
    font-size: 1.25rem;
    font-weight: 700;
    letter-spacing: -0.025em;
    color: var(--text-main);
}

/* Main Content Area */
.main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 1.5rem;
    gap: 1.5rem;
    overflow: hidden;
    /* Important for inner scrolling */
    height: calc(100vh - var(--header-height));
}

@media (min-width: 768px) {
    .main-content {
        padding: 2rem;
        gap: 2rem;
    }
}

/* =========================================
   4. COMPONENTS: CONTROLS
   ========================================= */
.controls-panel {
    background-color: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: 1.25rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    flex-shrink: 0;
    transition: box-shadow 0.2s, background-color 0.3s, border-color 0.3s;
}

.controls-panel:hover {
    box-shadow: var(--shadow-md);
}

.controls-wrapper {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

@media (min-width: 768px) {
    .controls-wrapper {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
    }
}

/* Input Group */
.control-group {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.control-label {
    font-weight: 600;
    color: var(--text-main);
    font-size: 0.95rem;
    white-space: nowrap;
}

/* Number Input (Custom Stepper) */
.number-input-group {
    display: flex;
    align-items: center;
    background: var(--bg-input-group);
    border-radius: var(--radius-md);
    padding: 4px;
    transition: background-color 0.3s;
    /* Inner spacing like iOS segmented control */
}

.input-btn {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    background: transparent;
    border-radius: var(--radius-sm);
    cursor: pointer;
    color: var(--text-muted);
    transition: all 0.2s;
}

.input-btn:hover {
    background-color: var(--bg-card);
    color: var(--color-primary-600);
    box-shadow: var(--shadow-sm);
}

#seconds-input {
    width: 3rem;
    text-align: center;
    border: none;
    background: transparent;
    font-weight: 600;
    color: var(--text-main);
    font-size: 1rem;
    appearance: none;
    /* Standard property */
    -webkit-appearance: none;
    -moz-appearance: textfield;
}

#seconds-input:focus {
    outline: none;
}

#seconds-input::-webkit-outer-spin-button,
#seconds-input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

/* Custom Range Slider */
.slider {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    max-width: 240px;
    height: 6px;
    background: var(--border-color);
    border-radius: var(--radius-full);
    outline: none;
    cursor: pointer;
}

.slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--color-primary-600);
    border: 3px solid var(--bg-card);
    box-shadow: 0 0 0 1px var(--color-primary-100), var(--shadow-sm);
    cursor: pointer;
    transition: transform 0.15s, box-shadow 0.15s;
}

.slider::-webkit-slider-thumb:hover {
    transform: scale(1.1);
    box-shadow: 0 0 0 4px var(--color-primary-100);
}

/* Checkboxes / Options Area */
.options-group {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
}

@media (min-width: 640px) {
    .options-group {
        margin-left: auto;
    }
}

.checkbox-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--text-main);
    cursor: pointer;
    background-color: var(--bg-checkbox);
    padding: 0.5rem 0.75rem;
    border-radius: var(--radius-md);
    border: 1px solid transparent;
    transition: all 0.2s cubic-bezier(0.2, 0, 0, 1);
    user-select: none;
}

.checkbox-wrapper:hover {
    background-color: var(--bg-checkbox-hover);
    box-shadow: var(--shadow-sm);
    border-color: var(--border-color-hover);
}

/* Hide default checkbox but keep it accessible for tab focus */
.checkbox-wrapper input[type="checkbox"] {
    appearance: none;
    width: 1.15em;
    height: 1.15em;
    border: 1.5px solid var(--color-slate-400);
    border-radius: 4px;
    background-color: var(--color-white);
    display: grid;
    place-content: center;
    flex-shrink: 0;
    transition: all 0.2s;
    margin: 0;
}

.checkbox-wrapper input[type="checkbox"]::before {
    content: "";
    width: 0.65em;
    height: 0.65em;
    transform: scale(0);
    transition: 0.1s transform ease-in-out;
    box-shadow: inset 1em 1em white;
    transform-origin: center;
    clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
}

.checkbox-wrapper input[type="checkbox"]:checked {
    background-color: var(--color-primary-600);
    border-color: var(--color-primary-600);
}

.checkbox-wrapper input[type="checkbox"]:checked::before {
    transform: scale(1);
}

/* Active State for the whole chip when checked */
.checkbox-wrapper:has(input:checked) {
    background-color: var(--color-primary-50);
    color: var(--color-primary-700);
    border-color: var(--color-primary-100);
}

.checkbox-wrapper label {
    cursor: pointer;
}

/* Tooltip */
.tooltip-container {
    position: relative;
    display: inline-flex;
    align-items: center;
    color: var(--color-slate-400);
    cursor: help;
    margin-left: -0.25rem;
    /* pull closer to the previous item */
}

.tooltip-icon {
    width: 18px;
    height: 18px;
    transition: color 0.2s;
}

.tooltip-container:hover .tooltip-icon {
    color: var(--color-primary-600);
}

.tooltip {
    position: absolute;
    bottom: 150%;
    right: 0;
    width: max-content;
    max-width: 250px;
    background: var(--color-slate-800);
    color: var(--color-white);
    padding: 0.5rem 0.75rem;
    border-radius: var(--radius-sm);
    font-size: 0.75rem;
    line-height: 1.4;
    text-align: left;
    white-space: normal;

    opacity: 0;
    visibility: hidden;
    transform: translateY(8px);
    transition: all 0.2s;
    z-index: 100;
    pointer-events: none;
    box-shadow: var(--shadow-lg);
}

/* Arrow for Tooltip */
.tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    right: 8px;
    /* Align with icon */
    border-width: 6px;
    border-style: solid;
    border-color: var(--color-slate-800) transparent transparent transparent;
}

.tooltip-container:hover .tooltip {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

/* =========================================
   5. COMPONENTS: EDITORS
   ========================================= */
.editors-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    min-height: 0;
    /* Necessary for flex scroll */
}

@media (min-width: 1024px) {
    .editors-area {
        flex-direction: row;
    }

    .editor-panel {
        flex: 1;
        width: 0;
        /* Force equal width */
    }
}

/* Editor Panels */
.editor-panel {
    display: flex;
    flex-direction: column;
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    overflow: hidden;
    transition: flex 0.4s cubic-bezier(0.2, 0, 0, 1), min-width 0.4s, border-color 0.3s;
    min-width: 0;
}

/* Panel Header */
.panel-header {
    padding: 1rem 1.25rem;
    background: var(--bg-app);
    border-bottom: 1px solid var(--border-color);
    font-weight: 600;
    color: var(--color-slate-700);
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 0.95rem;
    transition: background-color 0.2s, border-color 0.3s;
}

[data-theme="dark"] .panel-header {
    color: var(--text-main);
}

.collapsible-header {
    cursor: pointer;
}

.collapsible-header:hover {
    background-color: var(--bg-checkbox-hover);
}

.panel-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 200px;
    position: relative;
    overflow: hidden;
}

/* Input Styles */
textarea {
    flex: 1;
    width: 100%;
    padding: 1.25rem;
    border: none;
    resize: none;
    font-family: var(--font-mono) !important;
    font-size: 0.9rem;
    color: var(--text-main);
    background: transparent;
}

textarea:focus {
    outline: none;
    background: var(--bg-app);
}

/* Output Styles (Dark Theme) */
.dark-panel {
    background: #1e1e1e;
    /* VS Code Dark bg */
    border-color: #333;
}

.dark-header {
    background: #252526;
    /* VS Code Header bg */
    border-bottom-color: #333;
    color: #cccccc;
}

.code-content {
    flex: 1;
    overflow: auto;
    min-height: 0;
    display: flex;
    flex-direction: column;
}

pre {
    margin: 0;
    flex: 1;
    display: flex;
}

code {
    flex: 1;
    padding: 1.25rem;
    font-family: var(--font-mono) !important;
    font-size: 0.9rem;
    color: #d4d4d4;
    /* VS Code default text */
}

/* Highlight.js Overrides (Resurrected) */
.hljs-keyword {
    color: #ff7b72 !important;
}

.hljs-number {
    color: #79c0ff !important;
}

/* Arrow Separator */
.arrow-separator {
    display: none;
    color: var(--color-slate-300);
    align-self: center;
}

@media (min-width: 1024px) {
    .arrow-separator {
        display: flex;
    }
}

/* =========================================
   6. COLLAPSE SIDEBAR (Desktop)
   ========================================= */
.editor-panel.collapsed {
    flex: 0 0 48px;
    /* Narrower sidebar */
}

.editor-panel.collapsed .panel-body {
    display: none;
}

.editor-panel.collapsed .panel-header {
    height: 100%;
    flex-direction: column;
    justify-content: center;
    /* Align top */
    padding: 1.5rem 0;
    gap: 1rem;
    background: var(--color-slate-50);
}

.editor-panel.collapsed .panel-header .header-title {
    display: none;
}

.toggle-wrapper {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--color-slate-500);
}

.toggle-label {
    font-size: 0.85rem;
    font-weight: 500;
}

.editor-panel.collapsed .toggle-wrapper {
    flex-direction: column-reverse;
    /* Put label under arrow or rotatet it */
    gap: 0.5rem;
}

.editor-panel.collapsed .toggle-label {
    writing-mode: vertical-rl;
    text-orientation: mixed;
    letter-spacing: 2px;
}

.chevron {
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    width: 24px;
    height: 24px;
    color: var(--color-slate-400);
}

/* Desktop: Collapsed Arrow points RIGHT */
.editor-panel.collapsed .chevron {
    transform: rotate(-90deg);
    margin-top: 0;
    width: 20px;
    height: 20px;
}

@media (max-width: 1023px) {

    /* Mobile: Toggle label visible & proper alignment */
    .toggle-label {
        display: block;
    }

    .editor-panel.collapsed .toggle-wrapper {
        flex-direction: row;
        /* Horizontal alignment */
        justify-content: center;
    }

    .editor-panel.collapsed .panel-header {
        justify-content: center;
        /* Center content vertically in the header strip */
        padding: 0.75rem 0;
        /* Reduced padding for compact mobile strip */
        gap: 0;
    }

    /* Mobile: Collapsed Arrow points UP (indicating 'Click to Open' upwards or simply up) */
    .editor-panel.collapsed .chevron {
        transform: rotate(180deg);
    }
}

/* =========================================
   7. UTILS & BUTTONS
   ========================================= */
/* Copy Button */
.copy-btn {
    border: 1px solid var(--border-color);
    background: rgba(255, 255, 255, 0.05);
    /* Slight tint */
    color: var(--text-muted);
    padding: 0.5rem 0.85rem;
    border-radius: var(--radius-md);
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.copy-btn:hover {
    background: var(--bg-checkbox-hover);
    color: var(--text-main);
    border-color: var(--border-color-hover);
}

/* In dark mode, we might want the header copy button to look a certain way,
   but since it's in the dark panel, it's fine. Wait, dark-panel has hardcoded colors.
   Let's check .dark-panel below.
*/

/* Helper Text */
.text-blue {
    color: #60a5fa;
}

/* Scrollbars */
.custom-scrollbar::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

.custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
    background: rgba(120, 120, 120, 0.3);
    border-radius: 4px;
    border: none;
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: rgba(120, 120, 120, 0.5);
}

/* Theme Toggle Button */
.theme-toggle {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid var(--border-color);
    background: var(--bg-card);
    /* Make it distinct from header bg */
    color: var(--color-slate-500);
    border-radius: 50%;
    /* Circular button looks more modern */
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    /* Bouncy transition */
    box-shadow: var(--shadow-sm);
    position: relative;
    overflow: hidden;
}

.theme-toggle:hover {
    background-color: var(--bg-checkbox-hover);
    color: var(--color-primary-600);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
    border-color: var(--color-primary-100);
}

.theme-toggle:active {
    transform: translateY(0);
}

[data-theme="dark"] .theme-toggle {
    background: var(--bg-input-group);
    /* Slightly lighter than header in dark mode */
    border-color: var(--border-color);
    color: #fbbf24;
    /* Sun color */
}

[data-theme="dark"] .theme-toggle:hover {
    background-color: var(--color-slate-700);
    border-color: var(--color-slate-600);
    color: #fcd34d;
}

/* Icon Animation */
.theme-icon-sun,
.theme-icon-moon {
    position: absolute;
    transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease;
}

.theme-icon-sun {
    opacity: 0;
    transform: rotate(-90deg) scale(0.5);
}

.theme-icon-moon {
    opacity: 1;
    transform: rotate(0) scale(1);
}

[data-theme="dark"] .theme-icon-sun {
    opacity: 1;
    transform: rotate(0) scale(1);
    display: block;
    /* Ensure visibility override */
}

[data-theme="dark"] .theme-icon-moon {
    opacity: 0;
    transform: rotate(90deg) scale(0.5);
    display: block;
    /* Keep in DOM for anim */
}

/* Update Panel & Header colors to be theme aware */
.editor-panel {
    display: flex;
    flex-direction: column;
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    overflow: hidden;
    transition: flex 0.4s cubic-bezier(0.2, 0, 0, 1), min-width 0.4s, border-color 0.3s, box-shadow 0.3s;
    min-width: 0;
}

.editor-panel:focus-within {
    box-shadow: var(--shadow-md);
    border-color: var(--color-primary-100);
}

[data-theme="dark"] .editor-panel:focus-within {
    border-color: var(--color-slate-600);
}

.panel-header {
    padding: 1rem 1.25rem;
    background: var(--bg-app);
    border-bottom: 1px solid var(--border-color);
    font-weight: 600;
    color: var(--color-slate-700);
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 0.95rem;
    transition: background-color 0.2s, border-color 0.3s, color 0.2s;
}

[data-theme="dark"] .panel-header {
    background: var(--bg-input-group);
    /* Slightly distinct header in dark mode */
    color: var(--text-main);
}

.collapsible-header:hover {
    background-color: var(--bg-checkbox-hover);
}

.textarea {
    color: var(--text-main);
}

textarea {
    color: var(--text-main);
    line-height: 1.6;
    /* Improved readability */
}

textarea:focus {
    background-color: var(--bg-app);
}

/* Make dark panel adhere to theme or stay dark?
   Usually the "Output" is code, which often stays dark.
   But the user might want a light mode code editor?
   The existing .dark-panel has hardcoded dark colors.
   Let's keep it hardcoded dark for now as it looks like a console/terminal.
   But we should check if its border matches the theme.
*/
.dark-panel {
    /* Keep hardcoded dark background for code output even in light mode?
       Original was #1e1e1e.
       Let's stick to that for now, but update border.
    */
    background: #1e1e1e;
    /* Keep terminal dark */
    border-color: #333;
}

/* Force Dark Header for Code Output to match the terminal body */
.panel-header.dark-header {
    background-color: #252526;
    /* VS Code Header bg-ish */
    border-bottom: 1px solid #333;
    color: #e2e8f0;
}

/* Adjust Copy Button inside dark header */
.panel-header.dark-header .copy-btn {
    border-color: #334155;
    color: #94a3b8;
}

.panel-header.dark-header .copy-btn:hover {
    border-color: #64748b;
    color: #f8fafc;
    background-color: rgba(255, 255, 255, 0.1);
}

/* Success state for copy button in dark header */
.panel-header.dark-header .copy-btn.copied {
    border-color: var(--color-success);
    color: var(--color-success);
    background: rgba(34, 197, 94, 0.1);
}

.panel-header.dark-header .header-left .icon {
    color: #60a5fa;
    /* Keep the blue icon color */
}

/* Dark Panel (Output) Refinements */
/* Ensure the output code looks good */
#output-code {
    font-family: var(--font-mono);
    line-height: 1.6;
}

/* If we want the output to be light in light mode, we would change this.
   For now, I'll leave it as a "terminal view" which is typically dark.
*/